{
  "$schema": "https://raw.githubusercontent.com/AppThreat/purl4ml/refs/heads/main/schemas/purl-type-extended-definition.schema.json",
  "$id": "https://packageurl.org/types/cpan-extended-definition.json",
  "type": "cpan",
  "type_name": "CPAN",
  "description": "CPAN Perl packages",
  "uri_compliance": {
    "namespace_encoding": "uppercase",
    "name_encoding": "verbatim",
    "version_encoding": "verbatim"
  },
  "repository": {
    "use_repository": true,
    "default_repository_url": "https://www.cpan.org/",
    "supported_repositories": [
      "https://www.cpan.org/",
      "https://metacpan.org/",
      "https://backpan.perl.org/",
      "https://cpan.metacpan.org/"
    ],
    "note": "CPAN packages are hosted on various CPAN repositories."
  },
  "namespace_definition": {
    "requirement": "optional",
    "case_sensitive": true,
    "encoding": "uppercase",
    "native_name": "author id",
    "note": "- To refer to a CPAN distribution name, the namespace MUST be present. In this case, the namespace is the CPAN id of the author/publisher. It MUST be written uppercase, followed by the distribution name in the name component. A distribution name MUST NOT contain the string ::.\n- To refer to a CPAN module, the namespace MUST be absent. The module name MAY contain zero or more :: strings, and the module name MUST NOT contain a -"
  },
  "name_definition": {
    "requirement": "required",
    "case_sensitive": true,
    "encoding": "verbatim",
    "native_name": "module or distribution name",
    "note": "The name is the module or distribution name and is case sensitive. When namespace is present, this is a distribution name (must not contain ::). When namespace is absent, this is a module name (may contain :: but must not contain -)."
  },
  "version_definition": {
    "requirement": "optional",
    "encoding": "verbatim",
    "native_name": "version",
    "note": "The version is the module or distribution version."
  },
  "qualifiers_definition": [
    {
      "key": "repository_url",
      "requirement": "optional",
      "description": "CPAN/MetaCPAN/BackPAN/DarkPAN repository base URL",
      "examples": ["https://www.cpan.org/", "https://metacpan.org/"]
    },
    {
      "key": "download_url",
      "requirement": "optional",
      "description": "URL of package or distribution",
      "examples": ["https://www.cpan.org/authors/id/D/DR/DROLSKY/DateTime-1.55.tar.gz"]
    },
    {
      "key": "vcs_url",
      "requirement": "optional",
      "description": "Extra URL for a package version control system",
      "examples": ["https://github.com/drolsky/DateTime"]
    },
    {
      "key": "ext",
      "requirement": "optional",
      "description": "File extension",
      "default_value": "tar.gz",
      "examples": ["tar.gz", "zip", "tar.bz2"]
    }
  ],
  "validation_rules": {
    "namespace": {
      "uppercase_required": true,
      "examples_valid": ["DROLSKY", "GDT", "OALDERS"],
      "examples_invalid": ["drolsky", "Drolsky", "DROLSKY/"]
    },
    "name": {
      "case_sensitive": true,
      "distribution_format": {
        "no_double_colon": true,
        "examples_valid": ["DateTime", "URI-PackageURL", "libwww-perl"],
        "examples_invalid": ["Perl::Version", "LWP::UserAgent", "URI::Package"]
      },
      "module_format": {
        "no_dash": true,
        "examples_valid": ["Perl::Version", "LWP::UserAgent", "URI"],
        "examples_invalid": ["URI-PackageURL", "libwww-perl", "DateTime-TimeZone"]
      }
    },
    "version": {
      "format": "perl-version",
      "examples_valid": ["1.013", "1.55", "6.76"],
      "examples_invalid": ["v1.013", "latest"]
    }
  },
  "common_patterns": [
    {
      "pattern": "pkg:cpan/{module}[@{version}]",
      "description": "CPAN module reference (namespace is absent).",
      "example": "pkg:cpan/Perl::Version@1.013"
    },
    {
      "pattern": "pkg:cpan/{author}/{distribution}[@{version}]",
      "description": "CPAN distribution reference (namespace is present).",
      "example": "pkg:cpan/DROLSKY/DateTime@1.55"
    }
  ],
  "anti_patterns": [
    "pkg:cpan/drolsky/DateTime@1.55",
    "pkg:cpan/DROLSKY/Perl::Version@1.013",
    "pkg:cpan/Perl-Version@1.013",
    "pkg:cpan/"
  ],
  "parsing_decision_tree": {
    "steps": [
      {
        "question": "Is there a namespace component?",
        "yes": "This is a distribution PURL. Extract the author/namespace.",
        "no": "This is a module PURL. Proceed with name parsing."
      },
      {
        "question": "Does the name component adhere to the rules for its type (distribution vs. module)?",
        "yes": "Extract the name.",
        "no": "Invalid PURL - name format violates rules for its type."
      },
      {
        "question": "Is there a version component?",
        "yes": "Extract everything after @ as version.",
        "no": "No version specified; this is permitted."
      }
    ]
  },
  "context": {
    "ecosystem": "Perl",
    "package_manager": "CPAN",
    "url_scheme": "pkg",
    "hierarchical_structure": "pkg:cpan/[{namespace}/]{name}[@{version}][?{qualifiers}]",
    "versioning_system": "Perl versioning",
    "dual_naming": "Supports both modules (namespace absent, name may contain ::) and distributions (namespace present, name may contain -)."
  },
  "edge_cases": [
    {
      "case": "PURLs without a version",
      "handling": "Version is optional and can be omitted for both modules and distributions.",
      "purl_impact": "Allows referencing the latest version of a package."
    },
    {
      "case": "Distinction between module and distribution",
      "handling": "The presence of a namespace component is the sole determinant: if present, it is a distribution; if absent, it is a module.",
      "purl_impact": "This structural rule determines which validation rules apply to the name component."
    }
  ],
  "llm_guidance": {
    "do_not_assume": [
      "All CPAN packages have a namespace.",
      "Module names can contain dashes (-).",
      "Distribution names can contain double colons (::).",
      "Author IDs (namespaces) are case-insensitive."
    ],
    "key_facts_to_remember": [
      "Namespace is optional. Its presence indicates a distribution, and its absence indicates a module.",
      "Module names (no namespace) may contain :: but not -.",
      "Distribution names (with namespace) may contain - but not ::.",
      "Author IDs (namespaces) must be uppercase.",
      "Version is optional."
    ],
    "common_mistakes_to_avoid": [
      "Using lowercase for author IDs.",
      "Using :: in distribution names (when a namespace is present).",
      "Using - in module names (when a namespace is absent).",
      "Confusing modules with distributions."
    ]
  },
  "examples": [
    {
      "purl": "pkg:cpan/Perl::Version@1.013",
      "description": "Perl module with version."
    },
    {
      "purl": "pkg:cpan/DROLSKY/DateTime@1.55",
      "description": "CPAN distribution with author and version."
    },
    {
      "purl": "pkg:cpan/DateTime@1.55",
      "description": "Module reference with version (module name is 'DateTime')."
    },
    {
      "purl": "pkg:cpan/GDT/URI-PackageURL",
      "description": "Distribution without version."
    },
    {
      "purl": "pkg:cpan/LWP::UserAgent",
      "description": "Module without version."
    }
  ],
  "incorrect_examples": [
    {
      "purl": "pkg:cpan/drolsky/DateTime@1.55",
      "description": "Author ID (namespace) contains lowercase letters, but must be uppercase.",
      "violation": "namespace_definition requires namespace to be uppercase."
    },
    {
      "purl": "pkg:cpan/DROLSKY/Perl::Version@1.013",
      "description": "A PURL with a namespace is a distribution, but its name contains '::', which is prohibited for distributions.",
      "violation": "name_definition note prohibits '::' in distribution names."
    },
    {
      "purl": "pkg:cpan/Perl-Version@1.013",
      "description": "A PURL without a namespace is a module, but its name contains '-', which is prohibited for modules.",
      "violation": "name_definition note prohibits '-' in module names."
    },
    {
      "purl": "pkg:cpan/",
      "description": "Missing name component, which is required.",
      "violation": "name_definition.requirement=required"
    }
  ],
  "references": [
    {
      "title": "CPAN",
      "url": "https://www.cpan.org/"
    }
  ],
  "metadata": {
    "last_updated": "2025-08-23"
  }
}