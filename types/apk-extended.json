{
  "$schema": "https://raw.githubusercontent.com/AppThreat/purl4ml/refs/heads/main/schemas/purl-type-extended-definition.schema.json",
  "$id": "https://packageurl.org/types/apk-extended-definition.json",
  "type": "apk",
  "type_name": "APK-based packages",
  "description": "Alpine Linux APK-based packages",
  "uri_compliance": {
    "namespace_encoding": "lowercase",
    "name_encoding": "lowercase",
    "version_encoding": "verbatim"
  },
  "repository": {
    "use_repository": true,
    "note": "There is no default package repository; this should be implied either from the distro qualifiers key or using a repository base url as repository_url qualifiers key.",
    "supported_qualifiers": [
      "distro",
      "repository_url"
    ]
  },
  "namespace_definition": {
    "requirement": "required",
    "case_sensitive": false,
    "encoding": "lowercase",
    "native_name": "vendor",
    "note": "The namespace is the vendor such as alpine or openwrt. It is not case sensitive and must be lowercased."
  },
  "name_definition": {
    "requirement": "required",
    "case_sensitive": false,
    "encoding": "lowercase",
    "native_name": "name",
    "note": "The name is the package name. It is not case sensitive and must be lowercased."
  },
  "version_definition": {
    "requirement": "required",
    "encoding": "verbatim",
    "native_name": "version",
    "note": "The version is a package version as expected by apk. The format is typically 'pkgver-rX', where 'pkgver' may include suffixes like '_alpha', '_p1', etc. The '-rX' release suffix is a strong convention but not strictly required for a version string to be valid."
  },
  "qualifiers_definition": [
    {
      "key": "arch",
      "requirement": "optional",
      "description": "The arch is the qualifiers key for a package architecture.",
      "examples": ["x86", "x86_64", "aarch64", "armhf", "armv7", "noarch"]
    },
    {
      "key": "distro",
      "requirement": "optional",
      "description": "The distribution name when using multiple distributions",
      "examples": ["alpine", "postmarketos"]
    },
    {
      "key": "repository_url",
      "requirement": "optional",
      "description": "Base URL for the package repository",
      "examples": ["https://dl-cdn.alpinelinux.org/alpine/"]
    }
  ],
  "validation_rules": {
    "namespace": {
      "lowercase_required": true,
      "examples_valid": ["alpine", "openwrt", "postmarketos"],
      "examples_invalid": ["Alpine", "OpenWRT", "postmarketOS"]
    },
    "name": {
      "lowercase_required": true,
      "no_spaces": true,
      "examples_valid": ["curl", "apk-tools", "libcrypto1.1"],
      "examples_invalid": ["Curl", "apk tools", "libcrypto@1.1"]
    },
    "version": {
      "format": "apk-version (pkgver-rX)",
      "supports_release": true,
      "note": "The release suffix (e.g., '-r0') is a strong convention for repository packages but is not strictly required for a version string to be valid.",
      "examples_valid": ["7.83.0-r0", "2.12.9-r3", "1.1.1t_p1-r0", "7.83.0"],
      "examples_invalid": ["2.12.9-r", "1.2.3-r"]
    }
  },
  "common_patterns": [
    {
      "pattern": "pkg:apk/{vendor}/{name}@{version}?arch={arch}",
      "description": "Standard Alpine package with architecture",
      "example": "pkg:apk/alpine/curl@7.83.0-r0?arch=x86_64"
    },
    {
      "pattern": "pkg:apk/{vendor}/{name}@{version}?arch=noarch",
      "description": "Architecture-independent package",
      "example": "pkg:apk/alpine/ca-certificates@20220614-r0?arch=noarch"
    },
    {
      "pattern": "pkg:apk/{vendor}/{name}@{version}?arch={arch}&repository_url={url}",
      "description": "Package with custom repository",
      "example": "pkg:apk/alpine/curl@7.83.0-r0?arch=x86_64&repository_url=https://myrepo.example.com/alpine/"
    }
  ],
  "anti_patterns": [
    "pkg:apk/Alpine/curl@7.83.0-r0?arch=x86",
    "pkg:apk/alpine/Curl@7.83.0-r0?arch=x86",
    "pkg:apk/alpine/curl?arch=x86",
    "pkg:apk/alpine?arch=x86",
    "pkg:apk/curl@7.83.0-r0?arch=x86"
  ],
  "parsing_decision_tree": {
    "steps": [
      {
        "question": "Is there a vendor/namespace component?",
        "yes": "Extract the vendor (first component after pkg:apk/)",
        "no": "Invalid PURL - vendor is required for apk"
      },
      {
        "question": "Is there a package name component?",
        "yes": "Extract the package name (component after vendor/)",
        "no": "Invalid PURL - package name is required for apk"
      },
      {
        "question": "Is there a version component?",
        "yes": "Extract everything after @ as version",
        "no": "Invalid PURL - version is required for apk"
      },
      {
        "question": "Are there qualifiers?",
        "yes": "Parse key=value pairs after ?",
        "no": "No qualifiers present"
      }
    ]
  },
  "context": {
    "ecosystem": "Alpine Linux",
    "package_manager": "apk",
    "url_scheme": "pkg",
    "hierarchical_structure": "pkg:apk/{vendor}/{name}@{version}?{qualifiers}",
    "versioning_system": "APK versioning (pkgver-rX) which may include suffixes like _alpha, _p1, etc.",
    "architecture_support": "Specific architectures (x86, x86_64, aarch64, etc.) and architecture-independent (noarch)",
    "repository_model": "Distributed with no central default repository"
  },
  "edge_cases": [
    {
      "case": "Packages with release suffix in version",
      "handling": "Version includes release number with -r prefix (e.g., -r0, -r3)",
      "purl_impact": "Release suffix must be preserved as it affects package version comparison"
    },
    {
      "case": "Packages with version suffixes",
      "handling": "Versions may contain suffixes like _alpha, _beta, _rc, or _p(atch) before the release number.",
      "purl_impact": "These suffixes are part of the version and must be preserved verbatim."
    },
    {
      "case": "Architecture-independent packages",
      "handling": "Use 'noarch' as the architecture value",
      "purl_impact": "These packages can be installed on any architecture"
    },
    {
      "case": "Multiple repositories for same vendor",
      "handling": "Use repository_url qualifier to specify non-default repository",
      "purl_impact": "Allows disambiguation when same package exists in multiple repositories"
    }
  ],
  "llm_guidance": {
    "do_not_assume": [
      "All apk packages use the 'alpine' vendor",
      "Package names can contain uppercase letters",
      "Versions follow standard SemVer",
      "A release number (e.g., -r0) is strictly required",
      "There is a default repository URL"
    ],
    "key_facts_to_remember": [
      "Vendor/namespace is required and must be lowercase",
      "Package name is required and must be lowercase",
      "Version is required and follows APK versioning format",
      "Versions often include a release suffix (-r0, -r3, etc.) but are valid without one",
      "Architecture qualifier should be included when known, using 'noarch' for independent packages"
    ],
    "common_mistakes_to_avoid": [
      "Using uppercase letters in vendor or package name",
      "Omitting the required version component",
      "Incorrectly assuming a version without a release suffix is invalid",
      "Confusing with Android .apk files",
      "Assuming a default repository URL"
    ]
  },
  "examples": [
    {
      "purl": "pkg:apk/alpine/curl@7.83.0-r0?arch=x86",
      "description": "Standard Alpine package for x86 architecture"
    },
    {
      "purl": "pkg:apk/alpine/apk-tools@2.12.9-r3?arch=x86_64",
      "description": "APK tools package for x86_64 architecture"
    },
    {
      "purl": "pkg:apk/alpine/openssl@1.1.1t_p1-r0?arch=x86_64",
      "description": "Package with a patch suffix (_p1) in its version"
    },
    {
      "purl": "pkg:apk/alpine/ca-certificates@20220614-r0?arch=noarch",
      "description": "An architecture-independent package"
    },
    {
      "purl": "pkg:apk/postmarketos/devicepkg-base@3-r0?arch=aarch64",
      "description": "PostmarketOS package for ARM64 architecture"
    }
  ],
  "incorrect_examples": [
    {
      "purl": "pkg:apk/Alpine/curl@7.83.0-r0?arch=x86",
      "description": "Vendor with uppercase letters - violates lowercase requirement",
      "violation": "namespace_definition.case_sensitive=false and namespace_definition.encoding=lowercase"
    },
    {
      "purl": "pkg:apk/alpine/Curl@7.83.0-r0?arch=x86",
      "description": "Package name with uppercase letters - violates lowercase requirement",
      "violation": "name_definition.case_sensitive=false and name_definition.encoding=lowercase"
    },
    {
      "purl": "pkg:apk/alpine/curl?arch=x86",
      "description": "Missing version component - version is required for apk",
      "violation": "version_definition.requirement=required"
    },
    {
      "purl": "pkg:apk/alpine?arch=x86",
      "description": "Missing package name component - package name is required for apk",
      "violation": "name_definition.requirement=required"
    },
    {
      "purl": "pkg:apk/curl@7.83.0-r0?arch=x86",
      "description": "Missing vendor/namespace component - vendor is required for apk",
      "violation": "namespace_definition.requirement=required"
    }
  ],
  "references": [
    {
      "title": "Alpine Linux Package Management",
      "url": "https://wiki.alpinelinux.org/wiki/Alpine_Linux_package_management"
    },
    {
      "title": "APK Package Format",
      "url": "https://wiki.alpinelinux.org/wiki/Apk"
    },
    {
      "title": "Alpine Linux Wiki",
      "url": "https://wiki.alpinelinux.org/"
    }
  ],
  "note": "Not to be confused with Android packages with a .apk extension.",
  "metadata": {
    "last_updated": "2025-08-22"
  }
}