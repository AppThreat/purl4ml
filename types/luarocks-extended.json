{
  "$schema": "https://raw.githubusercontent.com/AppThreat/purl4ml/refs/heads/main/schemas/purl-type-extended-definition.schema.json",
  "$id": "https://packageurl.org/types/luarocks-extended-definition.json",
  "type": "luarocks",
  "type_name": "LuaRocks",
  "description": "Lua packages installed with LuaRocks",
  "uri_compliance": {
    "namespace_encoding": "lowercase",
    "name_encoding": "lowercase",
    "version_encoding": "lowercase"
  },
  "repository": {
    "use_repository": true,
    "default_repository_url": "https://luarocks.org",
    "supported_repositories": [
      "https://luarocks.org"
    ],
    "note": "LuaRocks packages are primarily hosted on the official LuaRocks server."
  },
  "namespace_definition": {
    "requirement": "optional",
    "case_sensitive": false,
    "encoding": "lowercase",
    "native_name": "user manifest",
    "note": "The user manifest under which the package is registered. If not given, the root manifest is assumed. It must be normalized to ASCII lowercase."
  },
  "name_definition": {
    "requirement": "required",
    "case_sensitive": false,
    "encoding": "lowercase",
    "native_name": "name",
    "note": "The LuaRocks package name. It must be normalized to ASCII lowercase."
  },
  "version_definition": {
    "requirement": "required",
    "case_sensitive": true,
    "encoding": "lowercase",
    "native_name": "full package version, including module version and rockspec revision",
    "note": "The full LuaRocks package version, including module version and rockspec revision. While technically case-sensitive, it must be lowercased in a PURL to ensure compatibility."
  },
  "qualifiers_definition": [
    {
      "key": "repository_url",
      "requirement": "optional",
      "description": "The base URL for a private LuaRocks server. If omitted, the default server (https://luarocks.org) is assumed.",
      "examples": ["https://example.com/private_rocks_server/"]
    }
  ],
  "validation_rules": {
    "namespace": {
      "lowercase_required": true,
      "examples_valid": ["hisham", "username", "organization"],
      "examples_invalid": ["Hisham", "user name", "user@name"]
    },
    "name": {
      "lowercase_required": true,
      "no_spaces": true,
      "examples_valid": ["luasocket", "luafilesystem", "packagename"],
      "examples_invalid": ["LuaSocket", "lua file system", "package@name"]
    },
    "version": {
      "format": "luarocks-version",
      "includes_revision": true,
      "lowercase_required": true,
      "examples_valid": ["3.1.0-1", "1.8.0-1", "0.1.0-1"],
      "examples_invalid": ["3.1.0", "latest", "3.1.0-1-1", "3.1.0-A"]
    }
  },
  "common_patterns": [
    {
      "pattern": "pkg:luarocks/{name}@{version}",
      "description": "Standard LuaRocks package from the root manifest.",
      "example": "pkg:luarocks/luasocket@3.1.0-1"
    },
    {
      "pattern": "pkg:luarocks/{namespace}/{name}@{version}",
      "description": "LuaRocks package from a user manifest.",
      "example": "pkg:luarocks/hisham/luafilesystem@1.8.0-1"
    },
    {
      "pattern": "pkg:luarocks/{namespace}/{name}@{version}?repository_url={url}",
      "description": "LuaRocks package from a private server.",
      "example": "pkg:luarocks/username/packagename@0.1.0-1?repository_url=https://example.com/private_rocks_server/"
    }
  ],
  "anti_patterns": [
    "pkg:luarocks/Hisham/luafilesystem@1.8.0-1",
    "pkg:luarocks/hisham/LuaFileSystem@1.8.0-1",
    "pkg:luarocks/hisham/luafilesystem@1.8.0",
    "pkg:luarocks/hisham/luafilesystem@1.8.0-1-1",
    "pkg:luarocks/"
  ],
  "parsing_decision_tree": {
    "steps": [
      {
        "question": "Is there a namespace component?",
        "yes": "Extract the namespace (first component after pkg:luarocks/)",
        "no": "Proceed with name parsing"
      },
      {
        "question": "Is there a package name component?",
        "yes": "Extract the package name",
        "no": "Invalid PURL - name is required"
      },
      {
        "question": "Is there a version component?",
        "yes": "Extract everything after @ as version",
        "no": "Invalid PURL - version is required"
      }
    ]
  },
  "context": {
    "ecosystem": "Lua",
    "package_manager": "LuaRocks",
    "url_scheme": "pkg",
    "hierarchical_structure": "pkg:luarocks/[{namespace}/]{name}@{version}[?{qualifiers}]",
    "versioning_system": "LuaRocks versioning, which includes a module version and a rockspec revision (e.g., 1.8.0-1).",
    "naming_convention": "Namespace, name, and version must all be lowercase."
  },
  "edge_cases": [
    {
      "case": "Packages in the root manifest",
      "handling": "These packages have a name but no namespace.",
      "purl_impact": "e.g., pkg:luarocks/luasocket@..."
    },
    {
      "case": "Version compatibility",
      "handling": "The version string is technically case-sensitive but must be lowercased to ensure compatibility with all LuaRocks versions.",
      "purl_impact": "A PURL with an uppercase character in the version is considered invalid."
    },
    {
      "case": "Private LuaRocks servers",
      "handling": "Use the 'repository_url' qualifier to specify a non-default server URL.",
      "purl_impact": "Allows referencing packages from private LuaRocks repositories."
    }
  ],
  "llm_guidance": {
    "do_not_assume": [
      "All LuaRocks packages have a namespace.",
      "Any PURL component can contain uppercase letters.",
      "The version can be omitted.",
      "The version format does not include a revision."
    ],
    "key_facts_to_remember": [
      "Namespace is optional.",
      "Package name is required.",
      "Version is required and must include the rockspec revision (e.g., 3.1.0-1).",
      "The namespace, name, and version must all be lowercase.",
      "Use the 'repository_url' qualifier for private servers."
    ],
    "common_mistakes_to_avoid": [
      "Using uppercase letters in any component.",
      "Omitting the required version component.",
      "Forgetting the rockspec revision in the version (e.g., using '1.8.0' instead of '1.8.0-1')."
    ]
  },
  "examples": [
    {
      "purl": "pkg:luarocks/luasocket@3.1.0-1",
      "description": "LuaSocket library from the root manifest."
    },
    {
      "purl": "pkg:luarocks/hisham/luafilesystem@1.8.0-1",
      "description": "LuaFileSystem library from the 'hisham' user manifest."
    },
    {
      "purl": "pkg:luarocks/username/packagename@0.1.0-1?repository_url=https://example.com/private_rocks_server/",
      "description": "Package from a private LuaRocks server."
    }
  ],
  "incorrect_examples": [
    {
      "purl": "pkg:luarocks/Hisham/luafilesystem@1.8.0-1",
      "description": "Namespace contains uppercase letters, which violates the lowercase requirement.",
      "violation": "namespace_definition requires lowercasing."
    },
    {
      "purl": "pkg:luarocks/hisham/LuaFileSystem@1.8.0-1",
      "description": "Package name contains uppercase letters, which violates the lowercase requirement.",
      "violation": "name_definition requires lowercasing."
    },
    {
      "purl": "pkg:luarocks/hisham/luafilesystem@1.8.0-1A",
      "description": "Version contains an uppercase letter, which violates the lowercase requirement for compatibility.",
      "violation": "version_definition requires lowercasing."
    },
    {
      "purl": "pkg:luarocks/hisham/luafilesystem@1.8.0",
      "description": "Missing the rockspec revision in the version.",
      "violation": "version_definition requires the full version, including the rockspec revision."
    }
  ],
  "references": [
    {
      "title": "LuaRocks Documentation",
      "url": "https://luarocks.org/"
    },
    {
      "title": "LuaRocks User Manual",
      "url": "https://github.com/luarocks/luarocks/wiki/User_Manual"
    },
    {
      "title": "LuaRocks Rockspec Format",
      "url": "https://github.com/luarocks/luarocks/wiki/Rockspec-format"
    }
  ],
  "metadata": {
    "last_updated": "2025-08-23"
  }
}