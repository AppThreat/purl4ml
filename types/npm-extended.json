{
  "$schema": "https://raw.githubusercontent.com/AppThreat/purl4ml/refs/heads/main/schemas/purl-type-extended-definition.schema.json",
  "$id": "https://packageurl.org/types/npm-extended-definition.json",
  "type": "npm",
  "type_name": "Node NPM packages",
  "description": "PURL type for npm packages.",
  "uri_compliance": {
    "namespace_encoding": "percent-encoded",
    "name_encoding": "lowercase",
    "version_encoding": "verbatim"
  },
  "repository": {
    "use_repository": true,
    "default_repository_url": "https://registry.npmjs.org/",
    "supported_repositories": [
      "https://registry.npmjs.org/",
      "https://npm.pkg.github.com/",
      "https://registry.yarnpkg.com/"
    ],
    "note": "The default repository is the npm Registry at https://registry.npmjs.org"
  },
  "namespace_definition": {
    "requirement": "optional",
    "case_sensitive": false,
    "encoding": "percent-encoded",
    "native_name": "scope",
    "note": "The namespace is used for the scope of a scoped NPM package. The npm scope @ sign prefix is always percent encoded as '%40'."
  },
  "name_definition": {
    "requirement": "required",
    "case_sensitive": false,
    "encoding": "lowercase",
    "native_name": "name",
    "note": "Per the package.json spec, new package 'must not have uppercase letters in the name', therefore the name must be lowercased. The npm name used to be case sensitive in the early days for some old packages."
  },
  "version_definition": {
    "requirement": "optional",
    "case_sensitive": true,
    "encoding": "verbatim",
    "native_name": "version",
    "note": "The version is the package version. It is case-sensitive."
  },
  "qualifiers_definition": [
    {
      "key": "vcs_url",
      "requirement": "optional",
      "description": "A URL to a version control system repository.",
      "examples": ["git://host.com/path/to/repo.git@4345abcd34343"]
    }
  ],
  "validation_rules": {
    "namespace": {
      "encoding_required": "%40",
      "examples_valid": ["%40angular", "%40myorg"],
      "examples_invalid": ["@angular", "%40Angular", "%40org name"]
    },
    "name": {
      "lowercase_required": true,
      "url_safe_required": true,
      "examples_valid": ["lodash", "react", "my-package_1"],
      "examples_invalid": ["React", "my package", "my@package", ".foobar", "_foobar"]
    },
    "version": {
        "case_sensitive": true,
        "examples_valid": ["12.3.1", "4.17.21-beta.1"],
        "examples_invalid": []
    }
  },
  "common_patterns": [
    {
      "pattern": "pkg:npm/{name}@{version}",
      "description": "Standard unscoped package with a version.",
      "example": "pkg:npm/foobar@12.3.1"
    },
    {
      "pattern": "pkg:npm/%40{scope}/{name}@{version}",
      "description": "Standard scoped package with a version.",
      "example": "pkg:npm/%40angular/animation@12.3.1"
    },
    {
        "pattern": "pkg:npm/{name}[@{version}]?vcs_url={url}",
        "description": "Package with a VCS qualifier.",
        "example": "pkg:npm/mypackage@12.4.5?vcs_url=git://host.com/path/to/repo.git%404345abcd34343"
    }
  ],
  "anti_patterns": [
    "pkg:npm/@angular/animation@12.3.1",
    "pkg:npm/Package@1.0.0",
    "pkg:npm/package@",
    "pkg:npm/"
  ],
  "parsing_decision_tree": {
    "steps": [
      {
        "question": "Does the path contain a scope (preceded by '%40')?",
        "yes": "The scope is the namespace. The segment after the scope is the name.",
        "no": "The path segment is the name. There is no namespace."
      },
      {
        "question": "Is there a version component?",
        "yes": "Parse everything after the last @ as the version.",
        "no": "No version specified; this is permitted."
      },
      {
        "question": "Are there qualifiers?",
        "yes": "Parse key=value pairs after ?.",
        "no": "No qualifiers present."
      }
    ]
  },
  "context": {
    "ecosystem": "Node.js",
    "package_manager": "npm",
    "url_scheme": "pkg",
    "hierarchical_structure": "pkg:npm/[%40scope/]{name}[@{version}][?{qualifiers}]",
    "versioning_system": "SemVer",
    "naming_convention": "Name must be lowercase. Optional scope must be lowercase and its '@' symbol must be percent-encoded to '%40'."
  },
  "edge_cases": [
    {
      "case": "Packages without a version",
      "handling": "The version component is optional and can be omitted.",
      "purl_impact": "Allows referencing a package in a version-agnostic way."
    },
    {
      "case": "Scoped packages",
      "handling": "The '@' symbol of the scope must be percent-encoded as '%40' to be a valid PURL.",
      "purl_impact": "A PURL with a literal '@' in the namespace/scope is invalid."
    }
  ],
  "llm_guidance": {
    "do_not_assume": [
      "The version is required.",
      "The '@' symbol in a scope does not need to be encoded.",
      "Package names can contain uppercase letters."
    ],
    "key_facts_to_remember": [
      "The scope's '@' symbol must be encoded as '%40'.",
      "The name must be lowercase.",
      "The version is optional and is case-sensitive.",
      "The 'vcs_url' qualifier is supported."
    ],
    "common_mistakes_to_avoid": [
      "Forgetting to percent-encode the scope's '@' symbol.",
      "Using uppercase letters in the package name.",
      "Assuming the version component is required."
    ]
  },
  "examples": [
    {
      "purl": "pkg:npm/foobar@12.3.1",
      "description": "Basic npm package reference."
    },
    {
      "purl": "pkg:npm/%40angular/animation@12.3.1",
      "description": "Scoped npm package with a percent-encoded scope."
    },
    {
      "purl": "pkg:npm/mypackage@12.4.5?vcs_url=git://host.com/path/to/repo.git%404345abcd34343",
      "description": "Package with a VCS qualifier."
    }
  ],
  "incorrect_examples": [
    {
      "purl": "pkg:npm/FOOBAR@12.3.1",
      "description": "Package name contains uppercase letters, which violates the lowercase requirement.",
      "violation": "name_definition requires lowercasing."
    },
    {
      "purl": "pkg:npm/@angular/animation@12.3.1",
      "description": "Scoped package with an unencoded '@' symbol.",
      "violation": "namespace_definition requires the '@' to be percent-encoded as '%40'."
    },
    {
      "purl": "pkg:npm/@scope@angular/animation@12.3.1",
      "description": "Invalid scope format with multiple unencoded '@' symbols.",
      "violation": "Invalid namespace format according to npm scope specification."
    },
    {
      "purl": "pkg:npm/foo bar@12.3.1",
      "description": "Package name contains spaces, which are not URL-safe characters.",
      "violation": "name_definition requires URL-safe characters."
    },
    {
      "purl": "pkg:npm/.foobar@12.3.1",
      "description": "Unscoped package name starts with a dot, which is not permitted.",
      "violation": "npm package.json spec prohibits leading dots/underscores for unscoped packages."
    },
    {
      "purl": "pkg:npm/_foobar@12.3.1",
      "description": "Unscoped package name starts with an underscore, which is not permitted.",
      "violation": "npm package.json spec prohibits leading dots/underscores for unscoped packages."
    },
    {
      "purl": "pkg:npm/foobar@",
      "description": "Empty version component. If the '@' is present, a version must follow.",
      "violation": "Version must not be empty if specified."
    }
  ],
  "references": [
    {
      "title": "npm package.json specification",
      "url": "https://docs.npmjs.com/cli/v11/configuring-npm/package-json"
    },
    {
      "title": "npm scope documentation",
      "url": "https://docs.npmjs.com/cli/v11/using-npm/scope"
    },
    {
      "title": "yarn manifest specification",
      "url": "https://yarnpkg.com/configuration/manifest"
    }
  ],
  "metadata": {
    "last_updated": "2025-08-23"
  }
}